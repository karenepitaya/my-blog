---
import IconChevronsRight from '~/icons/chevrons-right.svg'
import Tags from '~/components/Tags.astro'
import PostInfo from '~/components/PostInfo.astro'
import type { PublicArticleListItem } from '~/lib/publicApi'

interface Props {
  article: PublicArticleListItem
}

const { article } = Astro.props

const description = article.summary
const authorUsername = article.author?.username
const articlePath =
  authorUsername ? `/posts/${encodeURIComponent(authorUsername)}/${encodeURIComponent(article.slug)}` : `/posts`
const samePage = Astro.url.pathname === articlePath
const articleLinkBase = samePage ? `#${encodeURIComponent(article.slug)}` : articlePath
const articleLink = samePage ? articleLinkBase : `${articleLinkBase}?id=${encodeURIComponent(article.id)}`
---

<article class="w-full py-5 my-1 md:my-4 border-accent/10">
  <h1 class="mb-3 text-2xl text-heading1 font-semibold">
    <a href={articleLink}># {article.title}</a>
  </h1>
  <PostInfo article={article} class="mb-3 mt-4" />
  {description && <p class="pl-0.5 my-4 text-base/7 text-foreground">{description}</p>}
  {
    article.tagDetails.length > 0 && (
      <div class="mb-6">
        <Tags tags={article.tagDetails} />
      </div>
    )
  }
  <div>
    <a class="button flex items-center !pl-3.5" href={articleLink}>
      {samePage ? 'Continue' : 'Read'}
      <IconChevronsRight class="size-5 ml-2" />
    </a>
  </div>
</article>
