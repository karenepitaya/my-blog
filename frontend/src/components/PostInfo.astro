---
import { dateString } from '~/utils'
import type { PublicArticleListItem } from '~/lib/publicApi'
import MetaChip from '~/components/MetaChip.astro'

interface Props {
  article: PublicArticleListItem
  class?: string
}

const { article, class: className } = Astro.props

const authorUsername = article.author?.username ?? null
const authorHref = authorUsername ? `/authors/${encodeURIComponent(authorUsername)}` : undefined
const category = article.category
const categoryHref =
  category && authorUsername
    ? `/categories/${encodeURIComponent(authorUsername)}/${encodeURIComponent(category.slug)}`
    : undefined
const publishedAt = article.publishedAt ? new Date(article.publishedAt) : null
---

<div class:list={[className, 'text-foreground/80']}>
  <div
    class="flex flex-col gap-4 sm:gap-2 sm:flex-wrap items-start sm:items-center sm:flex-row"
  >
    {
      category && categoryHref && (
        <MetaChip variant="category" href={categoryHref}>
          {category.name}
        </MetaChip>
      )
    }
    {
      authorUsername &&
        (authorHref ? (
          <MetaChip variant="author" href={authorHref} title={`View author: ${authorUsername}`}>
            {authorUsername}
          </MetaChip>
        ) : (
          <MetaChip variant="author">{authorUsername}</MetaChip>
        ))
    }
    {publishedAt && (
      <MetaChip variant="date" title={publishedAt.toISOString()}>
        <time>{dateString(publishedAt)}</time>
      </MetaChip>
    )}
  </div>
</div>
