---
import Layout from '~/layouts/Layout.astro'
import PageHeader from '~/components/PageHeader.astro'
import AuthorCard from '~/components/AuthorCard.astro'
import { listPublicAuthors, type PublicAuthor } from '~/lib/publicApi'

export const prerender = false

let authors: PublicAuthor[] = []
let authorsError: string | null = null

try {
  const result = await listPublicAuthors({ page: 1, pageSize: 200 })
  authors = result.items
} catch (err) {
  authorsError =
    err instanceof Error ? err.message : 'Failed to load authors from server API'
}
---

<Layout title="About" description="About this site and its authors">
  <div class="mt-2 sm:mt-0">
    <PageHeader title="About" />
    <section class="mt-6 md:mx-2">
      <h2 class="text-heading2 text-xl font-semibold mb-4">Authors</h2>
      {
        authorsError ? (
          <p class="text-foreground/80">
            Failed to load authors: {authorsError}. Set `PUBLIC_API_BASE_URL` to your
            server base (e.g. `http://localhost:3000/api`).
          </p>
        ) : authors.length === 0 ? (
          <p class="text-foreground/80">No authors found.</p>
        ) : (
          authors.map((author) => <AuthorCard author={author} />)
        )
      }
    </section>
  </div>
</Layout>
