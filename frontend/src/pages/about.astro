---
import Layout from '~/layouts/Layout.astro'
import PageHeader from '~/components/PageHeader.astro'
import siteConfig from '~/site.config'
import AuthorCardLarge from '~/components/author-cards/AuthorCardLarge.astro'
import AuthorCardMedium from '~/components/author-cards/AuthorCardMedium.astro'
import { listPublicAuthors, type PublicAuthor } from '~/lib/publicApi'

export const prerender = false

let authors: PublicAuthor[] = []
let authorsError: string | null = null
const authorCardStyle = siteConfig.authorCardStyle ?? 'detailed'

try {
  const result = await listPublicAuthors({ page: 1, pageSize: 200 })
  authors = result.items
} catch (err) {
  authorsError = err instanceof Error ? err.message : 'Failed to load authors from server API'
}
---

<Layout title="About" description="About this site and its authors">
  <div class="mt-2 sm:mt-0">
    <PageHeader title="About" />
    <section class="mt-6 md:mx-2">
      <h2 class="text-heading2 text-xl font-semibold mb-4">Authors</h2>
      {
        authorsError ? (
          <p class="text-foreground/80">
            Failed to load authors: {authorsError}. Set `PUBLIC_API_BASE_URL` to your
            server base (e.g. `http://localhost:3000/api`).
          </p>
        ) : authors.length === 0 ? (
          <p class="text-foreground/80">No authors found.</p>
        ) : authorCardStyle === 'minimal' ? (
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {authors.map((author) => <AuthorCardMedium author={author} />)}
          </div>
        ) : (
          <div class="flex flex-col gap-4">
            {authors.map((author) => (
              <AuthorCardLarge author={author} detailHref={`/authors/${encodeURIComponent(author.username)}`} />
            ))}
          </div>
        )
      }
    </section>
  </div>
</Layout>
